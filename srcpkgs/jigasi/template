# Template file for 'jigasi'
pkgname=jigasi
version=1.1
revision=1
archs=x86_64
hostmakedepends="openjdk8-jre openjdk8 apache-maven>=3.5.0 unzip"
depends="openjdk8-jre"
short_desc="jigasi"
maintainer="Mathieu Kerjouan"
license="Apache-2.0"
homepage="https://www.jitsi.org"
distfiles="https://github.com/jitsi/jigasi/archive/v${version}.zip"
checksum=c86abc17aae4c3bc26b776516b65be055c547fbf98dc12d91d474747ebeb5a4a
wrksrc="jigasi-${version}"
# conf_files="/etc/sv/jitsi-videobridge/conf"

do_build() {
	export JAVA_HOME=/usr/lib/jvm/java-1.8-openjdk/jre
	mvn -B package --file pom.xml -Dassembly.skipAssembly=false
}

post_build() {
	unzip target/jigasi-linux-x64-${version}-SNAPSHOT.zip
}

do_install() {
	vmkdir usr/share/jigasi
	vcopy jigasi-linux-x64-${version}-SNAPSHOT/lib usr/share/jigasi
	vcopy jigasi-linux-x64-${version}-SNAPSHOT/jigasi.sh usr/share/jigasi
	vcopy jigasi-linux-x64-${version}-SNAPSHOT/graceful_shutdown.sh usr/share/jigasi
	vcopy jigasi-linux-x64-${version}-SNAPSHOT/jigasi-${version}-SNAPSHOT.jar usr/share/jigasi/jigasi.jar
	vcopy jigasi-linux-x64-${version}-SNAPSHOT/jigasi-${version}-SNAPSHOT-native-linux-64.jar usr/share/jigasi/jigasi-native.jar
	vcopy script/collect-dump-logs.sh usr/share/jigasi
	vcopy sript/example_handle_transcript_directory.sh usr/share/jigasi

	vmkdir etc/jitsi/jigasi
	vcopy lib/logging.properties etc/jitsi/jigasi
	vcopy jigasi-home/sip-communicator.properties etc/jitsi/jigasi
	vcopy jigasi-home/log4j2.xml etc/jitsi/jigasi

	vmkdir var/lib/jigasi/transcripts
}

